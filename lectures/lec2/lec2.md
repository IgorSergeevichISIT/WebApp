Лекция 2. Базы данных и ORM - YouTube

Transcript:
(00:00) Сегодня у нас вторая лекция и вторая лекция она максимально посвящена второго лабораторной работе мы сегодня поговорим про базу данных поговорим про использование в наших языках программирования и про создание схем в том числе и радиограмма ну и с базовыми диаграммы познакомимся пока что не совсем для 3 может быть чуть ближе к четвертому лабораторной работе Ну по крайней мере Итак Ну давайте вначале скажем Давайте но тем не менее я сегодня буду
(01:13) рассказывать и про тройку и про то и пере другое тем более свои особенности и там и там есть но для начала Давайте скажем вообще что такое база данных что это хранилище а что значит хранилище То есть
(02:30) это не просто система до управления это все-таки серверный вариант то есть баз данных у нас работает Вы тоже по принципу клиент сервер в принципе изначально там года 80 это была двухуровневая архитектура у нас был сервер который хранил данных был клиент который вносил данные либо соответственно их забирал и принципе такой подход он был популярен и в 90-е Ну там все равно свои прослойки добавились поэтому тоже скажем надо разделять эти понятия база данных система управления позволяет соединить
(03:49) это прослойка то что таблицы строится Давайте соответственно посмотрим концу лекции но вначале Давайте поговорим о том соответственно что вообще лучше посмотреть почитать перед тем как я надеюсь вы достаточно хорошо разбираетесь тоже рекомендация у нас
(04:57) Прямо во второй лабораторной работе там есть ссылка Вот на этот курс возраст который изображен здесь правой части и этот курс написан на технологии Питер ноутбуков Юпитер ноутбуки Да можно выполнять виде скриптов на питоне но там можно выполнять не только питон то здесь преимущество в том что вы можете использовать эти ноутбуки в виде ноутбуков соответственно со всем остальным репозитории есть делал этот курс тоже преподаватель можете тоже закрепить некоторые знания тут есть тоже отдельная У нас есть курс 4 семестра методичка по индексам
(06:04) я понял я понял вот Ну соответственно кто не делал можете тоже посмотреть и отдельно не в том и в другом курсе есть часть по индексам индекс и часть важная Особенно для бэкандера в принципе для развития у нас это не требуется обязательно но это дополнительное задание составное большие данные которые на 4 балла Вот это мы поговорили про репозитории про то где Что можно посмотреть если мы говорим про базы данных а если это структура то не может быть разный формат представления наиболее известно это у нас означает
(07:26) вот и она наиболее популярная вообще она развилась на основе одновременно достижений как математике так и программных средств которые позволили с одной стороны очень удобным образом развивать наши данные на такие структуры как таблицы или отношения но в отношении понять из математики таблицы и соответственно наш привычный языков программирования с одной стороны это позволяет очень гибку все разделять для того чтобы избегать дублирование информации Потому что если у Вас например есть одна большая таблица перечислены все товары
(08:27) у вас будет называться чтобы не было противоречивости что такое локально уникально но нам хочется иметь уникальное значение вот у нас есть Excel таблицы там куча колонок там факты по продаже У нас есть одна из колонок это товар товар написано строчкой что нужно делать чтобы в разных строчках не было товаров один тоже написано по-разному было мыло как минимум должно быть вынесено чтобы там есть такие понятия Вот в этой математике как
(09:30) первичные ключи функциональная зависимость одной колонки от другой но мы соответственно говорим про то что мы выносим табличку и соответственно уникальные это уже следствие идет для вас самый простой что добавляете данного типа таблиц воздам вообще Да скажем что она наиболее широко использовала поэтому вообще весь все разнообразие баз данных делятся на реляционные и все остальное традиционно называют так вот в чем недостатки есть какие-то недостатки Но скажем так возраст позволяет сделать
(10:36) Хоть это и не первая нормальная форма тот момент когда мы сохранили в колледже со или массив или файл это уже не ну файл если можно данные в принципе если адрес уже нет Нам нужно отдельно улицу отдельно дом Ну да это отдельное направление это первое это вообще в принципе самый главный недостаток такой есть медленно но они универсальны универсальная они знают что в целом они задачу решают быстрее остальных Но в среднем есть задача
(11:39) которые на которых они работают Ну и самое главное проблема которую возникает когда у нас нужно выбирать между тем что мы делаем транзакционную систему или аналитическую что нам важнее получать частые отчеты какие-то разнообразные Либо мы добавляем Либо мы делаем какой-то очень большой Селект большого количеству условий если мы делаем большой Селект то нам нужно делать проще смысле если мы делаем большой Селект нам приходится делать достаточно медленно если их много поэтому проще в таком случае все выносить в отдельную большую таблицу то
(12:35) есть сделать огромное ненормализованную таблицу там дублировать все поля для того чтобы делать например отчетность раз будь здоров раз в день раз в месяц раз в неделю раз в год раз квартал отдельно Делаю таблицу которая работает на ежедневной операции когда клиент Каждый день делает платежи или что-то еще Но в данном случае у нас возникают проблемы когда хочется сделать что-то все-таки средний когда с одной стороны мы часто добавляем информацию но эта информация Я все-таки очень разнообразная и по-хорошему она начинает сильно
(13:21) дублировать у нас появляется большое количество колодок большое количество таблиц большое количество колонок [музыка] когда вот эти кусты квадратики мы не готовы с ним умереть Когда возникает а что значит Ну смотрите самое одна из наиболее проблем сущностей в системах это клиент клиенты Как физические лица такие
(14:26) юридические и возникают проблемы модификации с одной стороны полного реестра людей мы не можем попросить они у нас снова появляются только когда в то же время эти клиенты они могут по-разному появляться кто-то может нам про кого-то рассказать кого-то порекомендовать и у нас может быть неполная информация у нас может быть там фамилия имя отчество вас может быть не быть паспортных данных А паспорт поменяться в идеале Нам иметь СНИЛС СНИЛС нам никто не даст просто так и появляется Это только вот про фамилия имя отчество про паспорт мы не говорим
(15:04) про адрес в котором может быть корпус может корпус они быть может быть квартира может квартира не быть опять же могут быть разные может быть город село еще что-то и в общем появляется очень много вариантов куда что записать можно просто конечно всю строку и записать здесь клиенты просто один столбец и туда всю информацию через запятую написать но работать с ней нельзя надо как-то её структурировать если мы пытаемся такую сложную информацию оперировать у нас появляется большое количество пропусков по логичным причинам потому что это все
(15:40) как бы Разные классы что адреса что клиенты и появляется так называемый разреженная таблица а в разрешенной таблице у нас Малое количество полезных данных Поэтому нам хотелось бы как-то эффективно такие разреженные там и начиная с них мы можем использовать колоночные базы данных значения документы прежде всего из этого ограничения когда мы хотим хранить разрешенные и быстро с ними как-то оперировать у нас появляется возможность использовать какие-то колоночные пластик ориентирование у нас будут построены на основе
(16:35) ключ значение у нас четко есть какой-то идентификатор тот же снился еще что-нибудь и понимаем значение мы каким-то образом пытаемся с одной стороны поместить все данные в одну колонку с другой стороны хоть каким-то образом пытаться эти данные находить вообще на самом деле вот индексы возможность искать информацию быстрым образом они тесно связаны вообще со всеми базами данных но Давайте поговорим что же такое индексы тебя здесь невыносил никуда отдельно вот У кого какие идеи Что такое индекс что делать ориентирование
(17:36) поиска информации [музыка] алгоритмы и родились в чем суть У нас есть книжки которые лежат в каком-то порядке допустим по названию то есть вот есть название книги они отсортированы по алфавиту Мы хотим отдельно Составить список которым будут книги по авторам и наверное логично что одна и та же
(18:41) книжка Пушкина допустим Онегин Дубровский они будут наверное в разных частях вот этот список таблицу у нас сохранение книги они все последовательно нужно структура которая нам говорит нам нужны книги Пушкина Мы же не будем перебирать все абсолютно книги библиотеки нам хочется получить какой-то ограниченный список книг бумажных и где-то чтобы это было все перечислено поэтому мы можем просто составить отдельный список в котором будет по фамилиям авторов лежать карточки книг которые в свою очередь там могут например сортированы
(19:40) быть по названию Ну и так далее То есть мы можем отдельно подать и по жанру в зависимости от того сколько мы таких списков сделали мы сделали эти по сути индекс данных работает точно таким же образом у нас есть некоторые список которым все данные сортированы определенным Например у нас есть Клиенты и они могут располагаться вообще в любом порядке нам хочется иметь индекс который их по дате рождения соответственно у нас есть список который хранятся идентификаторы пользователей которые лежат по возрастанию соответственно чтобы найти клиентов
(20:28) которые родились 1 января 2000 года что нужно сделать нужно найти эту дату и соответственно с этой датой взять всех клиентов нам нужно подать еще а если у тебя в каждой дате по несколько Если в одну дату родилась 30 человек другой один но так в одном у тебя 30 там допустим у тебя до 2000 родилось много людей после 2000 как ты поймешь смотреть мы развиваем по на две части одни родились Мы каждый из списков
(21:35) Например у вас есть чтобы найти какое-то из 1024 где оно лежит в списке вам что нужно от начала пройтись да Ну если это массив это еще хорошо Да потому что вы однозначно Знаете ну и так чисто по порядку находится Ну а если эти числа не по порядку если там какие-то пустоты вам надо весь массив в худшем случае вот так работает плохая база которая Нет вы чтобы найти Ваш билет должны пройти весь список и база данных умрет никогда не дождется сервера соответственно Что нужно сделать нужно сделать индекс разбить все пополам и Например если у
(22:27) нас есть какая-то какое-то число мы можем разбить наш список пополам 168 меньше соответственно [музыка] Пусть меньше пусть будет какое-то число понятно И в итоге если мы просто перебираемся числа [музыка] логарифм 1000 это двоичный алгоритм 1000 это 10 вот ну то есть какой степени нужно возвести и в этом преимущество если у
(23:31) нас соответственно будет миллион записи 20 если миллиард 30 то есть в этом преимущество индекса чем больше вас становится запись тем быстрее искать Вот почему запрещенные социальные сети наши социальные сети и прочие системы работают быстро потому что все хранится по индексам и на основе этого работа в том числе производительность не хватает И вот когда их не хватает все равно используется индексы надо понимать что традиционный база данных это куча и в них есть индексы А какая-нибудь документоориентированная Или колоночная
(24:19) это по сути просто вот куча строк но на которые сделаны кучи индексов То есть у вас есть строка там куча данных но на неё сделаны ряд индексов которые позволяют по имени эти идентификаторы эти угоду по сути это как бы то же самое просто мы говорим вот эти данные мы не будем никак соединять мы не будем никак по ним искать мы ищем А дальше Вы как-то уже разберемся вот у нас внутри клиента лежит куча документов какая-то его история что мы говорим что мы не будем искать просто какую-то операцию мы не будем просто искать какой-то документ нам не нужен
(25:05) просто паспорт который что-то с ним произошло или какой-то документ который человек написал а не нужно просто заявление а нам важно что этот человек какие заявления писал в этом случае мы можем вот эту всю информацию запихнуть внутрь клиента и это аналог того как мы делаем жизнь у нас есть некий список внутри списка мы делаем какие-то более сложные конструкции можем сохранить больше это Вот пример документа ориентированный базы данных вот здесь как раз Вас представлен причем смотрите Он в двух вариантах может быть мы можем эти данные хранить
(25:43) как внутри то есть классический Так мы можем из ссылаться то есть мы можем сделать пару списков например один список документов один список клиентов внутри клиента ссылаться условно здесь у нас хранятся соответственно здесь у нас клиенты А это документы соответственно вот у нас есть клиент У них у клиента есть идентификаторы куча его атрибутики документа есть его идентификатор ключевой атрибутики что идентификатор клиента которому он относится и мы можем Что сделать мы можем либо внутрь клиента но здесь наоборот нарисовано
(26:35) а нет как раз правильно документ Ну либо либо здесь списка можно перечислить В общем как бы два варианта Возможно мы можем с одной стороны в документе сослаться на одного конкретного клиента с другой стороны мы можем у клиента перечислить все его документы да тогда соответственно вот клиенте мы указываем набор документов которые к нему относятся Либо мы просто ссылки на это все перечисляем варианты есть разные есть еще представление графа ориентированное Граф ориентированная Но это взаимосвязи пользователи у вас системе
(27:18) потом разные сетевые связи может быть если человек заболел каким-то заболеванием встречался и так далее вот анализ подобных зависимостей особенно здесь помогут графы колоночные ориентированно с классической ключ значение Ну и здесь традиционная традиционная база варианты хранения есть разные каждые работает своей конкретной задачей универсальным является революционным но наиболее широко распространенный реляционной баз данных является поэтому мы его используем но например если мы хотим какие-то специфичные документы хранить
(28:08) которые не могут делиться между пользователем один документ конкретного пользователя нам не нужно делать Вот это реляционное отображение мы можем каждый документ конкретно под одним пользователем записать и он не будет дублироваться еще важно мало того что он будет нескольких пользоваться Ну да это самое главное по-другому дублировать только так и будет ну и соответственно за счет вот этих колоночных структур мы можем тоже быстро искать здесь как бы мы больше упираем на удобство хранения здесь мы больше убираем вокруг
(29:00) Прошу прощения Ну а теперь давайте посмотрим на реляционного вас данных у нас основана на нескольких понятиях это не только отношения в первую очередь давайте начнем с того что у нас есть типы данных с них Наверное мы начинаем вообще в принципе знакомиться целые числа пробные числа даты очень большое количество разных Дат времени и прочего строки тоже с ними очень много всего какие-то более специфичные данные типа файлов денег и так далее на основе этих типов данных мы строим некоторые колонки в данном случае у нас
(29:59) домены колонки они получаются уже конкретно в таблице предметной области это соответственно у нас есть Ну табельный номер сотрудника У нас есть номер СНИЛС У нас есть номер паспорта и так далее из этих доменов у нас получается колонки каждое соответственно единица у нас представляет собой либо кортеж либо строку которая объединяет себе набор значений Но это строка таблица саму таблицу мы называем Еще также отношение по-английски Ну и колонки еще могут называться атрибутами ряд атрибутов могут иметь свои свойства Например у нас может быть первичный ключ
(31:12) это может быть уникальный Мы например хотим в чем проблема база данных у вас на компьютере у вас там клиенты пронумерованы допустим от 10 до 20 потому что первые 10 строк Вы экспериментировали вы их удаляли потом вы предоставили пользователям протестировать ваш функционал началось в это тестирование и ваш пользователь там создали еще 100 клиентов удаляли настоящие клиенты там заведены А дальше у вас уже начинается Промышленная эксплуатации и реальное использование продакшн и там у вас соответственно идентификатор
(32:11) пользователей одного до десяти Но все эти пользователи сразу модификаторы [музыка] в одной системе например есть мобильное приложение Ну это же на самом деле не просто мобильное приложение целая система Где у вас там логин и пароли значит информация о ваших Штатах есть отдельно банковской системы есть отдельная карточная система и так далее и в них по-хорошему нужно иметь какие-то идентификаторы однозначно определяющий пользователя счет проводку и так далее но это очень обобщающего можно сказать но это кстати в примере Пабло просто
(32:58) есть у нас может быть просто глобальный часовой идентификат если мы соответственно возьмем часовой идентификаты на 32 байта вот 32 байта соответственно мы можем примерно понять Какое количество информации можно закодировать таким сколько два тридцатых два в десятой это 1000 соответственно 1000 в кубе это миллиард 1004 триллион Ну то есть если мы считаем двоичной системе у нас каждую десятку возрастает тысячу раз соответственно 10 тысяча миллион миллиард у нас 128
(34:03) соответственно достаточно много информации но в целом для многих задач нам хватит мы можем один идентификатор использовать для того чтобы вообще идентифицировать очень многие объекты во многих Задачка тоже используется особенно вот если у вас есть важный это уже Вопрос оптимизации так Если есть вопросы задавайте Значит теперь
(35:09) о чем я здесь хочу сказать первое Давайте чуть-чуть поразбираем какую-то реальную структуру с которой чуть-чуть так она отдаленно напоминает какой-то предметно в принципе она может напоминать какую-то очень примитивную систему это в целом то что примерно должно получаться у вас дипломе у многих то что по-хорошему должно быть как результат вашей системы время понятно дело что мы не успеем все сделать и вы не можете уделить внимание всему если у Вас получается сделать хорошую это хорошо но не нужно стремиться за
(35:52) большим количеством таблиц нужно делать хорошую поэтому я всем вам говорю вас должно быть три ваших таблицы Плюс таблица пользователей 4 этих таблиц более чем достаточно чтобы реализовать вашу задачу и сделать хорошую структуру потому что не по опыту прошлых лет Я уверен у вас будут проблемы с тем что вы будете путать много ко многим вы будете путать один ко многим и так далее холодно В общем Скажите 30 градусов и так что у нас здесь показано здесь показано достаточно большая схема в которой У нас есть перелеты пассажиров
(36:41) и что у нас здесь основной наверное как бы такой основной структурой то есть вот есть знаете математики которая касается реляционной не знаю будет она или нет Но самое главное чего в принципе уходит это вот такое как-то единичный факт есть даже такое понятие фактов Нам нужен какой-то самый мельчайший факт который у нас происходит самая мельчайший факт который здесь у нас происходит это наверное что-то близко к перелету что-то вокруг перелета точнее перелета конкретного человека и соответственно нам надо искать что-то соединяющего
(37:26) пользователя и пассажира и перелет и что у нас такое есть скорее всего это вот Flight манифест То есть у нас есть Пассажир у пассажира пассажир может присутствовать нескольких бронированных Вот и бронирование он видимо может указать несколько перелетов соответственно Вот это единица манифеста она как раз и обозначает нам единичный некий перелет конкретного пользователя Вокруг этой таблицы уже дальше навешивается куча дополнительной информации Она говорит Кто этот пассажир какой у него багаж какие у него документы паспорт дальше
(38:14) если это перелет то какой-то авиакомпании с какого города Какой город у этого посадочного талона какое будет гей на выходе и тогда вот это наша главная таблица и от нее мы должны строить всю нашу логику Как с точки зрения структуры так и с точки зрения поиска нам нужно понимать что вот эта таблица она наиболее чаще всего будет заполняться то есть не будет наибольшее количество соответственно все что касается поиска вокруг нее добавление поэтому мы хотим сделать достаточно оптимальную структуру далее С какой точки зрения первое с точки зрения
(39:01) нормализованности чтобы у нас данный не дублировались и не противоречили за счет дублирования а второй момент это чтобы это еще называется консистентность это не противоречивость называется а второй момент нам хочется чтобы она работала достаточно быстро чтобы она работала быстрее наоборот нужно делать поменьше нам нужно наоборот Все стремиться сделать какой-то одной большой и вот как бы творчество проектировании баз данных оно как раз заключается в том чтобы умело ограничить количество таблиц с одной стороны и где-то тоже не
(39:42) переборщить внешними ключами чтобы оно тоже было достаточно оптимально Ну наверное исходя из этих четырех таблиц все остальное должно быть более менее Понятно У нас есть перелет перелет нам говорит аэропорт откуда он вылетел и куда соответственно это мы задаем двумя связи само собой один и тот же аэропорт он может быть в разных перелетах и он может быть как в одной связи так и в другой связи Для того чтобы отличать эти две связи Вы можете подписать здесь Chrome А здесь ту соответственно поля здесь такие есть депортер и
(40:21) конечно же там где много надо искать эти колонки дальше перелет осуществляется одной авиакомпании здесь Но на самом деле у нас опять же перелет может состояться несколько компаний тогда бы здесь появилась опять много далее У нас есть бронирование бронированию мы прикрепляем багаж мы прикрепляем не перелету а он закреплен забронировать бронирование это соответственно набор перелетов пассажиров которые свою очередь могут относиться к разным рейсом Это один и тот же человек у него есть какой-то багаж этот багаж в целом на все
(41:12) эти перелет Ну и здесь у нас уже проверка безопасности проверка багажа а ну здесь мы соответственно проверяем находится ли человек в стоп-листе Ну и вот по такой по глобальной структуре мы как бы прошлись То есть она такая достаточно понятна должна быть вам здесь есть привычные таблицы много ко многим здесь есть таблицы Когда у нас есть одновременно две связи здесь единственное не хватает иерархических связей Когда у нас допустим есть или какая-то другая иерархическая зависимость когда что-то подчинено другому здесь есть первичные ключи
(42:04) уникальные ключи здесь нет но для пассажира это может быть номер паспорта то есть номер паспорта скорее всего можно делать уникальным ключом вряд ли разные пассажиры летают Под разными паспортами у одного пассажира может быть другой паспорт вряд ли Ну и можно паспорт например добавить еще один модификатор вряд ли пассажиры когда он занесен в систему он занесен без паспорта хоть паспорт хоть какой-нибудь страны он у него должен быть заведен так про Unity сказали что паспорт можно сделать ряд полей можно сделать которые должны
(42:46) быть обязательно заполнены вот этот набор ограничений Вы тоже должны гибко подбирать С какой точки зрения каждое ограничение она замедляет работу вообще без всяких ограничений если условно не проверяет ничего это отвечаете Если вы добавите паспортом и так далее это будет ваша проблема Либо вы перекладываете компромисс многие выбирают отказываться в Контр Но тогда нужно качественно писать код сейчас я советую как бы лучше сделать такого в адекватном количестве дальше
(43:50) Ну вот нам тоже надо понимать это поле может быть у вас обязательно заполнено но может быть она заполнена самом начале допустим вы создаете заявку в этой заявке еще не указан номер билета он появится позже Или еще какая-то информация эта информация она либо должна быть уже тогда допустимое значение Либо вы тогда разорвете на две таблицы и во второй таблице Давайте еще там ряд полей только тогда когда у вас этот номер паспорта будет видео либо какая-то информация что же об этом думать и про типы данных мы наверное сильно
(44:35) останавливается сейчас не будем у нас есть символьные данные врача чем мы видим что многие из них ограничены либо 50 данными либо 20 данных зависимости от того насколько длинная должна быть здесь строка У нас есть здесь числовые данные вот эти мол например 4 до запятой два после запятой 4 до запятой это какой порядок у нас Сколько может вместиться четыре знака до запятой Какая масса может сместиться четыре знака Ну смотрите вот у нас написано здесь беречь у нас имеет Waiting [музыка] [музыка]
(46:20) 250 Но вообще более реальные они по 70 поднимают транспорт имеет не пассажирский но пассажирский на самом деле тоже достаточно много вот но опять же Наверное каждый пассажир не будет вести собой пассажирском самолете такой объем Да и пассажирский столько не потянет Ладно по типам данных мы наверное прошлись еще есть таймс это соответственно тип данных время Почему мы соответственно Что такое время это день недели времени Времени то есть она нам четко задает как и дату так и время я туда то есть мы четко знаем конкретно уникальный момент
(47:21) времени Это комбинация это очень важно широко используется у нас в наших структурах мы об этом тоже поговорим Так теперь давайте поговорим про Ну то есть предыдущую таблицу просто взял из интернета это нарисовал уже сам в старые как раз старый ML вы будете тоже сами рисовать что здесь у вас представлено постараемся сделать пример мастер-класс Как добавлять сейчас давайте просто разберем такой типовой с одной стороны но достаточно замысловатую структуру которая опять нет иерархических связей в которой например сотрудников можно друг другу починить То
(48:12) есть когда у нас есть начальник А у каждого сотрудника можно указать кто его начальник и указать идентификатор начальник тогда у вас появляется так называемая графическая структура когда сам на себя указывает и иерархический запрос когда мы начинаем Выведи мне подчиненных этого человека мы начинаем всех тех у кого он начальник и так далее можно так добавлять по уровню отдельно интересный вопрос У вас были иерархический запрос Но кто будет пока нам заниматься посмотреть собственно вот Блок Когда у нас есть ритуалы посты
(48:53) У нас есть некий пост внутри него есть реклама ответ на ответ и так далее базовые комментарии потом комментарии теперь У нас есть набор таблицы здесь базовый рассказали в предыдущем Это был перелет конкретного человека Вот сейчас И что здесь будет являться вот этой базовой товарной единицей но базовым фактом каким-то заказ это есть покупка да конкретного товара Ну то есть в принципе заказ очень близко и это логично С чего
(49:57) надо искать здесь просто есть вот это еще много ко многим она детализирует это не просто заказ заказе есть ряд товаров Тогда мы говорим что это как бы покупка пользователем этого товара какого-то конкретно ни в одном заказе их может быть несколько и как бы мы пляж вот этой таблице в принципе она как бы не такая сложная потому что здесь Ну особо каких-то сложных индексов и так далее не будет Мы наверное будем больше искать либо по товару либо по заказу либо потому что соответственно из них соответственно все индексы мы будем
(50:33) основном делать через эти таблицы а здесь мы просто будем искать по первичному ключу либо по одному из то есть скорее всего мы сделаем либо два отдельных индекса по товару по заказу либо один комбинированный но я не уверен что он даст особо выигрыша ты смотрите что такой момент Можно первичный ключ сделать комбинированным из двух столбцов вообще принципе математика нам Как говорит вот у вас есть таблица все поля этой таблицы это и есть первичный ключ У вас есть человек его фамилия имя отчество дата рождения место рождения и так далее Все это его
(51:17) уникальная информация она однозначно вместо 1 поэтому все будет Вот искусственно единицу Давайте сильно в это сейчас не уходить но в общем Здесь тоже интересно каждая колонка является первичным ключом здесь везде в остальных местах просто одиночные первичные ключи указанных это Ну то есть то что должно быть заполнено то что обязательно не может быть пустой Unic это
(52:20) уникальный конечно отличается от первичного чем не нулем а пустотой их может быть несколько то есть возможно Я думаю в основном Тоже самое все понятно То есть у нас есть отношения таблицы у каждого отношения У нас есть Колонки есть модификаторы в основном Какие вот эта связь С какой стороны один с какой стороны много Вот соответственно там где у нас что-то похожее на крестик это будет один там
(53:24) где у нас вот этот треугольник который называется воронья лапка еще это будет много но вот это нолик Что означает кружочек Это означает что здесь отношение от 0 до многих А здесь от 0 до 1 здесь мы можем посмотреть здесь четко один а здесь от 0 до 1 что это означает что у нас есть пользователь пользователь он однозначно существует этот пользователь он может быть клиентом То есть у него может быть одна запись где он указан Как клиент у него может быть записи он указан как сотрудник это может быть такая таблица ее может не быть пользователь он
(54:12) существует сотрудник не может не иметь записи пользователя клиент где он у нас здесь Но он тоже как бы обязан иметь запись пользователь но в теории там какой-нибудь поручитель еще кто-нибудь он не будет иметь связи с пользователем Да здесь тоже есть особенности где-то у нас от 0 до многих я не помню здесь где-то от одного до многих и что запись должна обязательно Ну например теории Да вот у нас есть человек у него документы теории Если человек родился у него как минимум есть документ свидетельство о рождении как минимум
(54:50) один документ у него должен здесь от 0 до многих можно как бы притянуть за уши что здесь отношение то ли Хотя в реальной системе скорее всего ничего Никакого свидетельства о рождении человека не знает теперь про типы данных У нас есть вроде как как модель оси это стандарт Но вот такого единого прям совсем стандарта не сложилось Слава Богу у нас такие слова как Селект и так далее Но вот самая большая проблема уже начинается с типами данных и вы можете посмотреть что в разных баз данных это все называется по-разному здесь еще нету
(55:32) возгласа и других все это только прореаляционные мы не говорим вообще не реляционной и мы видим что она хотя бы дата Да ну в общем она сильно по-разному везде присутствует как у нас называется числовые данные как у нас называется строки как у нас называется время и тогда видно что это все сильно отличается Ну вот самое главное это вот который булиновское значение так часто флот Понятно часто строковые данные разного размера далее вот какие-то крупные текстовые данные которые очень большие больше допустим 4000 символов мы можем сохранить как
(56:29) клоп Это большой текстовый объект можно хранить что здесь такого наверное основное сказал вот это как раз примеры какие-то менее типовых типов данных Когда у нас есть вот этот buenery large of juick blob который мы храним файл клоп это соответственно какой-то большой текст Ну например то же самое большое мы можем сохранить как раз в поле Club который силу Ну и отдельно есть как бы поля бывает уже предназначены
(57:34) в принципе тоже самое спокойно можете либо в текстовый формат если он небольшой документ его Логично село вынести другими буквами согласными и классными она приносится как поэтому Кэт но сайт в одном и том же слове по-разному оно звучит то же самое во французском испанском итальянском и так далее Теперь у нас есть или у нас есть
(58:42) [музыка] нам нужно создать структуру есть еще тоже два важных вот как бы подгруппы языка это Control English который Для чего Нам нужен предоставление Прав да на определенные объекты когда мы говорим что какой-то мы
(59:47) можем пока продажи без ролей говорить У нас есть пользователи Мы хотим предоставить таблицу одного пользователя другому а что такое пользователь байдар Что такое пользователи это это некая структура это некоторые объект то есть пользователи таблицы индексы это не пользовались тем можно это понимать пользователи которые у нас вот здесь это таблицы это таблица пользователь базы данных это некий объект обычно который однозначно мы можем разделить таблицы которые относятся допустим к
(1:00:53) покупателю и относится к продавцу таким образом Покупатель не будет иметь информации вообще никакой таблицам продавца продавец таблица покупателей какие-то таблицы будут общие например вынесены в отдельную схему использовать здесь можно подразумевать как схема некоторые совокупность объектов например юзер мы можем создать отдельного не знаю можно ли прям такой ими зарезервировано использовать как-нибудь для чего это нам понадобится для того чтобы разделить функционал это вообще уже хороший уровень когда мы на уровне базы
(1:01:41) данных защищаем наши данные и пользователи одной схема не видит таблицы другое и наконец Зачем нам нужен У нас есть такой транзакционный механизм базе данных Она говорит о том что у нас есть такие транзакции которые либо исполняются целиком либо не исполняется Например если вам нужно одновременно Создать пользователя добавить документ либо вам нужно создать заказ и уменьшить количество товаров на складе это одна операция вы не можете создать заказ не уменьшить количество я также либо удалить заказ либо откатить заказ не
(1:02:44) увеличить обратно заказ вернули Вы должны опять увеличить Вот это будет транзакция состоящий из двух операций и за ее управлением отвечает далее формата У нас есть вообще отдельная проблема вообще в мире сообщение у нас много языков мало того что люди общаются на разных языках по-разному их пишут кто-то секунды использует кто-то секунды не использовать тех или иных местах года считают от разных времен Ну в общем ужасов хватает поэтому для того чтобы все это объединить У нас есть форматы у которых соответственно
(1:03:47) то есть сама дата она в системе хранится просто Как число начиная с определенной либо она отрицательная либо она положительная к Что означает количество чего дней подробная часть означает если у вас есть число вы хотите получить следующий вот а дальше чтобы это вывести все текстом вам есть просто привидение то есть то же самое что у вас хранятся байты числа и вы решаете Либо вы точку ставите Либо вы пробел ставить в раздел разрядах Либо вы запятую там то же самое
(1:04:50) в дату вот у вас есть дата вы хотите ее написать там справа налево сверху вниз еще как-нибудь иероглифах еще написать У вас есть число однозначно понимаете что это поэтому на любом языке в любом формате вы нарисуете вам нужно только сказать первое как это число нарисовать каком-то необычном формате число получили у вас нужно прописать в каком формате Его надо парсить в каком месте искать дата в каком месте Через какое разделитель через там точку через слышание должно быть соответственно эти форматы вы будете
(1:05:30) указывать через запятую либо еще где-то зачем их нужно делать почему как бы нельзя без них жить Мы вроде там не пишем иероглифами или японским календарем не пользуемся но проблема в том что в разных системах могут стоять разные настройки Если у вас на компьютере стоят одни настройки настройки на сервере могут быть другие то может быть указан другой часовой пояс А может быть указано еще что-то поэтому Нужно чаще всего приводить в один и тот же формат более того у вас Candy может быть один формат фантазии другой на фронтенте там вообще
(1:06:03) еще отдельные свои особенности Ну кстати достаточно красивые Итак давайте подытожим про база данных собственно это не конец лекции это конец первой части [музыка] это борьба избыточностью с аномалиями Когда у нас один и тот же товар не начинает называться по-разному и мы не пишем один и тот же товар 10 раз тут понятное преимущество экономим в памяти и у нас есть классная высокоуровневый язык запросов то Что отличает от новой скелет баз данных есть классные языки которого Больше нигде нет все пытаются как-то повторить дальше в
(1:06:46) чем проблема вот эта математика на основе джойнов она на самом деле замедляет все потому что нам нужно каждую операцию искать Не знаю попробовать нормально смотрите так и в реальности мы все-таки не нормализуем до конца по колонкам либо не до конца по таблицам они как-то Ну и последнее как бы о чем надо помнить вообще в принципе при проектировании системы [музыка] что у нас данные не дублируются даже мало того что не дублируется по-разному [музыка] То есть у нас не появляется какие-то противоречия в таблице что у нас не
(1:07:47) получилось что в одной таблице мы товар переименовали в одной строке товар переименовали а во второй забыли у нас один и тот же товар в двух заказах Мы в одном переименовали в другом Нет мы его должны переименовывать В отдельной таблице в одном месте Когда он поменяется во всех заказ это называется консистентность Для этого нужны разные таблицы и желания доступность доступность означает очень примитивно Вот вы сидите покупаете билет не важно сколько там пользователь сколько там всего вы должны этот билет купить пусть
(1:08:18) она там работает чуть больше чуть медленнее но у вас это должно получаться на бесконечное количество и устойчивость к разделению означает о том что вы можете ваша система разделить на разные кусочки которые будут работать не получится сделать систему которая не такая такая Например если вы делаете авиакомпанию которая продает билет Как сделать так чтобы вот у вас в нескольких местах есть пользователи которые одновременно хотят купить билеты устойчивость к изделиям разных местах они хотят купить билеты это уже
(1:09:10) доступность они хотят купить билеты они не хотят просто посидеть посмотреть они хотят чтобы их операция была не должно быть ситуация когда проданы либо ни одного из пользователей билетами продали соответственно сделать это по теореме как нельзя Но как можно сделать Можно например билеты выдавать То есть у вас 500 билетов вы продаете сначала билетов закончились выдали еще соответственно пока у вас есть билеты Если вдруг у вас произошла ситуация когда продали одновременно два А у вас было было берете следующий порции никакого
(1:09:59) глобальная проблема не возникает за счет бизнес-процесса вы решаете технические ограничения понятно но ты например если покупаешь в каком-то стадионе то ты его покупаешь обычно на этот нет ты его покупаешь на сегмент То есть ты покупаешь Ну допустим ты хочешь купить 4 билет на сегмент и тебе выдаются эти места потом посмотрел это в итоге два человека сидят тут два человека сидят тут у меня вполне такое было компании ты купил билет А места ты выбираешь потом то есть билеты Тебе продали А уже места ты выбираешь из того что тебе подойдет
(1:10:44) вот Ну по-разному может быть да то есть если ты покупаешь бизнес-класс ты будешь выбрать например билет в принципе наверное людей которые покупают бизнес-классы так много людей которые покупают там не такое большое консистентность не такая большая доступность А если ты покупаешь канал который постоянно там это более востребовано дальше постепенно подойдет сейчас поговорим про инструменты вам понадобится администрирование можно делать через консоль конечно это не очень удобно есть инструмент но у вас в методичке по гриб дата гриб
(1:11:23) от компании поэтому мы например у себя в наших реальных проектах Как делают у нас ты такая он обладает интерфейсом неважно каком языке подняли через админы примерно похоже функционал дает Джанго админ панель это тоже функционал для редактирования данных по сути в базе данных Но это именно деймай получить данные обновить давать вы не можете создать какую-то таблицу и так далее adminor это полностью функционал непосредственно базе данных через Джанго это такая прослойка как раз на основе вариант здесь Наверное более менее все понятно
(1:12:15) здесь можете заселексить можете создать что-нибудь и так далее здесь просто в интерфейсе редактируйте там понятно Да дальше есть такое понятие как миграция [музыка] есть так называемый контуры либо слои слышали есть слой есть на котором пользователь работает и вы получаете из этого деньги а есть слой на котором вы например внедрили какую-то доработку и пользователь на нем не работает и соответственно что вам нужно сделать Вам нужно вам нужно перенести данные с одного слоя на другой Но не все вам не нужно создавать какие-то тесты клиентов
(1:13:13) тестовые проводки вам нужно перенести типы То есть у вас есть типы операций покупка продажа ипотека кредит или вот виды расчетов и вы хотите чтобы Независимо На каком слое вот не нужно было сходить в самом начале эти операции пришлось создавать И для этого нужны миграции миграции данных для гуава можно сделать через такой инструмент гусь [музыка] соответственно для джанга в принципе вот то что по крайней мере мы используем вроде как используется чаще всего Это непосредственно миграции которые много под собой чего скрывает
(1:13:55) потому что иммиграции с помощью ее тоже можно мигрировать вообще капсулирует но и Да надо это не путать миграциями Джанго позволяет но тоже там не совсем есть это какой начальной начальной дмр чтобы при инициализировать понятно То есть ddl это как создать переменную написать а вот эта миграция данных это написать самом начале равно 0 А потом дмр это уже где-то в коде Форе меняется значение перемен далее Давайте Собственно уже перейдем про использование баз данных и перейдем первый диаграмме это у нас комбинированная
(1:14:45) диаграмма какая здесь изображена диаграмма развертывания виде вот этих кубиков и диаграммы компонентов виде вот этих блоки эти блоки это программные компоненты то есть программа которая выполняется на ваших узлах кубики это узлы либо программные узлы либо реальные физические узлы либо программы так называемые контейнеры можно кубики внутри кубика Я думаю основная логика Понятно трехуровневая трех Звездная архитектура черногорит потому что у нас есть клиент У нас есть база данных а между ними есть серые приложения первое приложение
(1:15:32) обеспечивает нас так называемый бизнес логикой То есть это собственно совокупность мифов форов и прочего что должно происходить при выполнении тех или иных действий мы с вами не говорим просто про действия с вами говорим что если мы оплачиваем заказ у нас должна быть заполнена дата продажи у нас должно наверное в этот момент обновиться количество у нас должно простаяться статус оплаты может быть какая-то еще информация вот это все относится к бизнесу Это должно быть скрыто соответственно серия приложений Ну и скорее всего это будет
(1:16:11) лежать в модели у нас будет контроллер который отвечает за покупку вызывает метод модели Либо вы это все в контроллере разные это может быть в контроле Ну и у нас есть база данных попасть серые приложения в нашем случае это наш джанга которая одновременно сочетает себе как http так и собственно логику И соответственно в данном случае у нас клиент он будет тонким клиентом далее У нас будет сервировать сайт рендеринг то есть Single page Application одностраничное приложение там будет толстый клиент То есть клиент
(1:16:57) будет содержать бизнес логику у себя на клиенте сейчас у нас бизнес логика вынесена тонкий клиент когда он только отображает информацию Ну и думаю тоже максимально предельно понятно еще раз это устройство вот эти компоненты квадратиками это компоненты программы дальше вот приведены два примера на разных языках соответственно таких конструкция как курсор курсора позволяет нам выполнять запросы прямо вплоть Зачем нам нужно Давайте посмотрим как это выглядит нам в любом случае нужно установить Коннект наши базе данных
(1:17:45) нам нужно указать мы указываем соответственно может быть и порт это может быть дополнительно может быть по умолчанию теперь теперь указывайте пользователя то есть вот тот пользователь база данных это вот эта схема с его пароль баз данных может быть несколько пользователей каждого будет свои таблицы указывайте название базы На одном сервере может быть несколько вот этих как бы структур и дальше Вы описываете курсор то есть по какой базе данных вы создаете этот курсор какой запрос внутри этого курсора вы будете выполнять Ну дальше Можете
(1:18:50) написать коммент если это ну и закрывается закрывается курсор закрывается вот такой простой пример здесь Можете передавать Как что-то фиксированное так и в вашем примере вы будете передавать подставлять модификатор из вашего интерфейса интерфейс нажали кнопку идентификатор сюда подставили например чтобы сделать из вашего а то же самое в принципе выглядит на Гоа здесь у нас есть место куда мы вписываем сам запрос конструкции могут быть разные чуть-чуть Но вам нужно будет тоже ногой сделать один такой одну такую функцию Где вы будете удалять
(1:19:40) запись через запрос весь основной функционал через в одном примере мы с вами показываем что мы с вами умеем самым примитивным образом работать через успех запрос вообще насколько как бы я хорошо не хорошо насколько я знаю коллеги рассказывает практически не используется все пишут как раз через но есть модель вы создаете модель куда вы вписываете структура но не используются эти автоматические механизмы человек все это делается Зачем это все нужно Давайте разберем какой-то практический пример вспомним некое великое произведение под названием
(1:20:23) давайте сделаем такое приложение такой Запрос который будет на основании предпочтение литературных героев друг друга определять У нас есть какое-то направленное отношение человек любит другого человека нам нужно понять есть что мы делаем У нас есть одна таблица которая показывает эту направленную связь есть просто список литературных героев если мы выведем просто запросом список вот этих соотношений кто кому нравится вот мы получим такое табличку какие здесь не ограничения Ну во-первых понятно что любовь может быть
(1:21:15) и тогда у нас только в одну сторону идет отношения вот что нам бы хотелось сделать нам бы хотелось вот эту колонку Соединить с такой же таблицы соединить таблица мы вторую колонку Соединяем [музыка] эту таблицу совпадений Мы хотим соответственно соединить и это мы сделаем здесь то есть мы потому кто оказывается у одного [музыка] но Уже обратно если если обратная связь и мы это указываем вот здесь заодно Мы в конце фильтруем что мы
(1:22:19) говорим а вот самое начало то есть вот тот человек кто нравится вот самого конца то есть уже нравится ли он втором магазине получился у нас просто один человек нравится третий нам нужно проверить 1 31 тот человек или нет Вот это мы сделаем здесь в конце и еще одно ограничение которое мы здесь внесем это то что чтобы у нас записи не повторялись понятное дело если один человек нравится второму второй человек нравится первым у нас будет как от одного То есть первый второй первый так и будет 2 1 2 и нам нужно как-то одну
(1:22:57) запись только из них оставить самое примитивная мы говорим Соединяем только когда первое меньше чем второй если у нас второй первый второй просто так не добавляю однозначно у нас появляется только один набор записей и соответственно из войны мира вот мы получаем Лиза первая жена Андрея Болконского Андрей Болконский Наташа Ростовой Наташа Ростова первый Звук вот оно получили три такие записи Понятно Если записи будет больше а расчётов в базе данных и поисков поезда она будет больше но результаты они не будут сильно большие почему это
(1:23:31) показывает необходимость использования Это говорит о том что вот такой запрос он на самом деле сейчас очень примитивный он должен быть гораздо сложнее и он в себе Вот дважды сочетает вот эту таблицу совпадения и это очень большая нагрузка тут возникает очень много фильтрации нам нужно искать один список поэтому искать списку второй список дальше фильтровать ограничивать и так далее И это нам говорит о том что мы бы хотели вот эти все поиски ограничить сразу байдар вот она там хорошо знает где что На какой части жесткого диска
(1:24:10) лежит Пусть лишний раз никуда не ходит главное не пересылает по сети там на наш веб-сервер и не ГРУ и нашего сервера не занимаются этим перебором пусть это все происходит Вот такие сложные запросы обязательно надо выносить [музыка] чтобы их вынести нужно его написать и соответственно [музыка] тоже важно уметь писать стиль запрос теперь собственно Давайте перейдем быстренько пробежимся Значит у нас опять напоминаю есть Framework Jungle А вот состоит из на паттерне вести настроек мы поработали с моделью очень примитивно у нас была
(1:24:56) просто коллекция Теперь мы говорим о том что нам бы хотелось эту коллекцию как-то автоматически из вас данных настроек но примитивный способ как это сделать на Гоа Понятно вы делаете структуру вы делаете из этой структуры коллекцию с помощью курсора эту коллекцию Вы можете сами сделать эту модель на основе запроса проблем нет теперь собственно Джанго нам позволяет как миграции данных организовать как и миграции структуры то есть и в основе этого лежит что город лежит гуайро что в Джанго это его стандартный механизм У нас есть база данных и что
(1:25:49) нам нужно сделать мы либо создаем некоторые класс и на основе этого класса мы создаем таблицу мы делаем классно условия класса у нас генерируется идея Ну понятно теперь может выполняться там создается какая-то таблица Либо наоборот У нас есть таблицы и мы на основе таблиц делаем Класс вот это два разных подхода которые доступны можно создать таблицы сгенерировать таблицы и то и другой работы Единственное что здесь еще не показано что здесь мы говорим но реально об этом мы скажем попозже и он здесь не показывает это два разных
(1:26:36) если мы говорим про детей про начальных эта миграции дальше для того чтобы вообще работать с urm нам нужно опять же к базе данных подключиться в Джанго мы будем описывать вот такой конструкции подключения в Go вам предложено вынести параметр подключения и соответственно прописать их здесь к этому вы просто обращаетесь но опять же порт username все это прописываете таким образом то есть из N вы получаете эти данные подключаетесь поезда Здесь вы просто прописываете в настройках подключения поездах опять же хост значит движок
(1:27:23) пароль пользователю пользователи база данных название базы дальше [музыка] модель модель опять же Это просто класс если мы говорим про Джанго если мы говорим про гол где классов нету там это структура Да и это просто набор полей Ну просто это класс без методов набор полей которых мы храним какие-то можем сделать одну запись можем сделать коллекцию записи никакой проблемы нет соответственно на основе модели модель вы здесь наследуете вот когда вы создаете новый класс вы создаете вы не просто так чтобы работали вот эти механизмы без
(1:28:17) этого работать Здесь вы импорт миграция миграции это вот эти либо детей когда вы создаете таблицу это не только один раз поменяли классы применили у вас опять применились [музыка] но Давайте вот самое главное это все-таки миграцию ОРМ который детей это самое основное вы сделали классы на основе не сгенерировали таблицы на основе таблиц генерировали класс Джанго это все скрыто Под командой У вас есть специальные файлики уже забыл то ли это менедж поэт или каком-то внутреннем В общем есть
(1:29:21) собственно файл миграции Какие действия нужно выполнить То есть у вас этот Файлик создается и вы его применяете он применяется Какие действия нужно выполнить базе какие объекты нужно создать Как нужно применить Как нужно поменять тоже интересные механизм методической описано вот на основе этих действий командной строке далее мы с вами говорили про детей не хватает еще наверное всяких селектов использовать наши данные таблицу хорошо Мы зашли через отмены или через еще что-то написали intert и записали А теперь возникает вопрос А как
(1:30:05) приложение вывести страницу со списком услуг вам нужно как выполнить это не детей Для этого нам нужны его это такие конструкции не буду брать не знаю как они называются но выполняет то же самое они скрывают под собой выполнение курсора но этот курсор выполняется как метод К объекту безусловно У вас есть класс услуга услуги есть метод который например называется Get и этот Get чтобы скрывает он говорит что выполнить курсор возьми данные из таблицы Запиши мои поля и эти поля и потом тебя там просто как либо если это там
(1:30:57) сделай коллекцию заполнит это [музыка] здесь соответственно [музыка] то есть здесь именно скрывается как минимум селекты Ну еще insert update delete делит Понятно наоборот делает курсор по апдейту возвращает вам соответственно успешно и успешно Ну и что нужно еще знать рецепты так называемые Если вы пишете На орн то вы вызываете методы вашей вашего класса Мы привыкли пользоваться SQL самый сложный в плане селектор селекции еще куча всего и как этим всем
(1:32:01) пользоваться есть куча конструкций которые позволяют прописать где будет у вас где у вас будет орк Где у вас будет нот Где у вас будет Юнион и так далее Все это прописано здесь погода по-моему тоже вас ссылка есть Это не то что вы пишете Как сделать живой надо написать один цикл пройтись по одной коллекции ложный цикл пройтись по коллекции дальше поставить их если айтишник один равен логических по-другому знаешь мы добавляем новую коллекцию значит И то и другое как бы на самом деле базу данных делать Вот этот Loops цикл в цикле но это очень
(1:32:45) примитивно и там очень хороший механизм поэтому вы делаете Это не так если вы делаете фильтрацию по двум полям ответите есть две возможности даже три возможности есть можно через интернет написать можно писать через запятую операции Если вы делаете Юнион то вы написали один метод написали точку написали указали что в этот метод передать у вас здесь появляется как бы раньше написали что-то и он что-то сейчас условно пишите что-то Юнион [музыка] немного таком упрощенном виде больше похоже может быть здесь [музыка]
(1:33:55) так Ну давайте соответственно
